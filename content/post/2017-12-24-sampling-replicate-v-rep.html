---
title: 'Random sampling: replicate v. rep'
author: "Jesse Tweedle"
date: '2017-12-24'
slug: sampling-replicate-v-rep
categories: ["r", "random"]
tags: ["r"]
description: 'A short post to describe repeatedly randomly generating objects.'
---



<p>The problem: you want to generate a random collection of letters.</p>
<pre class="r"><code>letters %&gt;% sample(size = 4) %&gt;% paste0(collapse = &quot;&quot;) 
## [1] &quot;woje&quot;</code></pre>
<p>Great. Now do it 10 times.</p>
<pre class="r"><code>letters %&gt;% sample(size = 4) %&gt;% paste0(collapse = &quot;&quot;) %&gt;% rep(8)
## [1] &quot;rdjy&quot; &quot;rdjy&quot; &quot;rdjy&quot; &quot;rdjy&quot; &quot;rdjy&quot; &quot;rdjy&quot; &quot;rdjy&quot; &quot;rdjy&quot;</code></pre>
<p>üòñ. Why am I like this. Ok, <code>rep</code> copies the object 8 times. It doesn‚Äôt draw 8 samples. So just write a function:</p>
<pre class="r"><code>sample_letters &lt;- function(size = 4) {
  letters %&gt;% sample(size = size) %&gt;% paste0(collapse = &quot;&quot;)
}
rep_ &lt;- purrr::safely(rep)
rep_(sample_letters, 8) %&gt;% .$error %&gt;% .$message
## [1] &quot;attempt to replicate an object of type &#39;closure&#39;&quot;</code></pre>
<p>This gd thing (although I learned a bit about <code>safely</code> here, üëç). It wants to repeat the function definition, not repeatedly run the function. Ok.</p>
<pre class="r"><code>rep(sample_letters(), 8)
## [1] &quot;kopn&quot; &quot;kopn&quot; &quot;kopn&quot; &quot;kopn&quot; &quot;kopn&quot; &quot;kopn&quot; &quot;kopn&quot; &quot;kopn&quot;</code></pre>
<p>Gd-it. Same problem. It runs the function once, then repeats the object 8 times. Ok, surely if I use <code>lapply</code> (or <code>sapply</code> = simplify apply?), which is designed to run functions a million times, this will work</p>
<pre class="r"><code>sapply(1:8, function(x) { sample_letters() }) 
## [1] &quot;rptf&quot; &quot;stmp&quot; &quot;epsw&quot; &quot;knyh&quot; &quot;fjhy&quot; &quot;xiuy&quot; &quot;rgwl&quot; &quot;nsxt&quot;</code></pre>
<p>Ugh, finally. But a pyrrhic victory. The code is ugly and horrible and requires a function argument that we throw away like plastic bottles in the ocean and those arguments will come back and kill us all.</p>
<p>Ok, double-checking the documentation in <code>lapply</code>, there‚Äôs finally one to do what I want. But of course (to Hadley‚Äôs dismay, I‚Äôm sure), the syntax is halfway between <code>lapply</code> and <code>rep</code>, which makes it impossible to remember.</p>
<pre class="r"><code>replicate(8, sample_letters())
## [1] &quot;gbxh&quot; &quot;tpoe&quot; &quot;utpi&quot; &quot;rfpx&quot; &quot;cbpj&quot; &quot;gcml&quot; &quot;ekzy&quot; &quot;qhad&quot;</code></pre>
<p>The <code>n</code> argument comes first like an <code>apply</code>, while in <code>rep</code> it comes second, but it‚Äôs called <code>replicate</code> and not <code>rapply</code>. On top of that, you can hack the regular <code>lapply</code> call to draw it randomly (as long as the size argument is in <code>sample_letters</code>), but now we‚Äôve dropped the parentheses!</p>
<pre class="r"><code>sapply(rep(4, 8), sample_letters)
## [1] &quot;yqeh&quot; &quot;wehz&quot; &quot;akol&quot; &quot;fdzq&quot; &quot;ewsq&quot; &quot;mvqh&quot; &quot;drpx&quot; &quot;eynm&quot;</code></pre>
<p>If we do that with <code>replicate</code>, it replicates the function definition. üò°. These are the mental steps I go through everytime I want to randomly sample something (usually just for fake data and testing).</p>
<div id="answer-for-now" class="section level2">
<h2>Answer, for now</h2>
<pre class="r"><code>replicate(8, sample_letters())
## [1] &quot;lewt&quot; &quot;afjn&quot; &quot;qelb&quot; &quot;aktr&quot; &quot;tmlf&quot; &quot;sdvi&quot; &quot;zkdt&quot; &quot;dqyi&quot;</code></pre>
<p>To do: understand wtf it‚Äôs ok to repeat a function definition (like in <code>replicate</code> without parentheses) but not other times (like in <code>rep</code> without parentheses).</p>
</div>
