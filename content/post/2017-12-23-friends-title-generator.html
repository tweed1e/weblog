---
title: "Friends Title Generator, Part 1"
author: "Jesse Tweedle"
date: 2017-12-23T05:33:11-05:00
description: "This post includes a R code script to generate Friends episode titles."
tags: ["r", "friends", "tidytext", "nlp", "markov model"]
categories: ["r", "friends"]
---



<p>To fulfill my lifelong desire to write Friends scripts, I‚Äôll start by writing a Friends episode title. By that I mean a script that writes a Friends episode title. If you‚Äôre like me, you want to be creative, but I want to study artists and writers and distill their creativity into a recipe, and then just repeat it over and over. Isn‚Äôt that how artistic success works?</p>
<p>Start with episode data from the first <a href="/post/2017-12-18-rvest-friends-episodes/">Friends post</a>. We <code>rvest</code>ed a bunch of stuff from the <a href="http://www.imdb.com/title/tt0108778/">Friends IMDB</a>.</p>
<pre class="r"><code>titles &lt;- werfriends::friends_episodes %&gt;% as_tibble() %&gt;%
  select(-director, -writers)
titles
## # A tibble: 236 x 5
##    season episode                                           title rating
##     &lt;dbl&gt;   &lt;dbl&gt;                                           &lt;chr&gt;  &lt;dbl&gt;
##  1      1       1           The One Where Monica Gets a Roommate¬†    8.5
##  2      1       2           The One with the Sonogram at the End¬†    8.2
##  3      1       3                         The One with the Thumb¬†    8.3
##  4      1       4             The One with George Stephanopoulos¬†    8.3
##  5      1       5 The One with the East German Laundry Detergent¬†    8.6
##  6      1       6                          The One with the Butt¬†    8.3
##  7      1       7                      The One with the Blackout¬†    9.0
##  8      1       8                  The One Where Nana Dies Twice¬†    8.2
##  9      1       9               The One Where Underdog Gets Away¬†    8.3
## 10      1      10                        The One with the Monkey¬†    8.2
## # ... with 226 more rows, and 1 more variables: n_ratings &lt;dbl&gt;</code></pre>
<div id="check-out-the-words" class="section level2">
<h2>Check out the words</h2>
<p>Apply the easy <code>tidytext</code> function <code>unnest_tokens</code> to process the titles, then remove the filler words by applying <code>anti_join</code> on the <code>tidytext</code> dataset <code>stop_words</code>.</p>
<pre class="r"><code>title_words &lt;- titles %&gt;% 
  unnest_tokens(word, title) %&gt;% 
  anti_join(stop_words)
## Joining, by = &quot;word&quot;

# replace &#39;rachel&#39;s&#39; with &#39;rachel&#39;
title_words %&gt;% 
  mutate(word = gsub(pattern = &quot;&#39;s&quot;, replacement = &quot;&quot;, x = word)) %&gt;% 
  count(word, sort = TRUE)
## # A tibble: 266 x 2
##        word     n
##       &lt;chr&gt; &lt;int&gt;
##  1   rachel    28
##  2     ross    24
##  3     joey    16
##  4 chandler    11
##  5   phoebe    10
##  6        1     9
##  7        2     9
##  8   monica     9
##  9  wedding     9
## 10     dies     6
## # ... with 256 more rows</code></pre>
<p>Now we know the most important thing. Although character names don‚Äôt seem to have an <a href="/post/2017-12-22-post-selection-inference-on-friends-titles-in-r/">effect on episode success</a>,they‚Äôre obviously the most popular title words. On the other hand, I suppose people get married and people die pretty often in a sitcom.</p>
<pre class="r"><code># ok, now we know what&#39;s important
# the characters, weddings, people and things dying.
titles %&gt;% filter(grepl(&quot;dies&quot;, title, ignore.case = TRUE))
## # A tibble: 6 x 5
##   season episode                           title rating n_ratings
##    &lt;dbl&gt;   &lt;dbl&gt;                           &lt;chr&gt;  &lt;dbl&gt;     &lt;dbl&gt;
## 1      1       8  The One Where Nana Dies Twice¬†    8.2      2594
## 2      2       3     The One Where Heckles Dies¬†    8.4      2316
## 3      2      18 The One Where Dr. Ramoray Dies¬†    8.5      2165
## 4      2      20  The One Where Old Yeller Dies¬†    8.3      2084
## 5      7      13      The One Where Rosita Dies¬†    8.5      1842
## 6     10      15     The One Where Estelle Dies¬†    8.6      1783</code></pre>
<p>Dang, ok. 3 old people, old yeller, Joey‚Äôs DOOL character, and JOEY‚ÄôS CHAIR ROSITA.</p>
</div>
<div id="a-sentence" class="section level2">
<h2>A sentence</h2>
<p>A sentence is a sequence of words. Given a word, e.g., ‚ÄúOne‚Äù, there is a probability that the next word in the sequence is ‚ÄúWhere‚Äù (pretty high actually), and slightly different probabilities for all the other words (‚ÄúWith‚Äù is also very high). Thinking this way, we think of the sentence generator as a network. Each vertex is a word in the set of titles. A directed edge exists if the word pair <code>(word, next)</code> exists in the set of titles. The edge weight is the frequency of times <code>next</code> is the word that follows <code>word</code> in all the titles.</p>
<pre class="r"><code>word_transitions &lt;- titles %&gt;% 
  unnest_tokens(word, title) %&gt;% 
  group_by(season, episode) %&gt;% 
  filter(row_number() &gt; 1) %&gt;% 
  mutate(nxt = lead(word), 
         nxt = ifelse(is.na(nxt), &quot;EOL&quot;, nxt)) %&gt;% 
  group_by(word, nxt) %&gt;% 
  count() %&gt;% 
  group_by(word) %&gt;% 
  mutate(weight = n / sum(n))</code></pre>
<p>I find <code>dplyr</code> makes it super easy to get a solution right away; here, you can almost code as fast as you think (take <code>titles</code>, convert it to words, drop the first word, make a new variable representing the ‚Äònext word‚Äô, calculate the frequency the next word appears given each current word). On the other hand, it‚Äôs a bit difficult to follow after the fact, maybe because you write it so quickly that you forget to document it. Also the constant <code>group_by</code> and <code>ungroup</code>ing. üòë.</p>
</div>
<div id="now-make-me-a-title-r" class="section level2">
<h2>Now make me a title, R</h2>
<p>So, now we have a tidy matrix of word transition probabilities. All we have to do is start with the words ‚Äúthe one‚Äù, and calculate the next word in the sequence (by using the great <code>sample_n</code> to pick the next word in the title). Then keep going until you hit the end of the sentence (‚ÄòEOL‚Äô).</p>
<pre class="r"><code>generate_title &lt;- function() {
  new_title &lt;- c(&quot;the&quot;, &quot;one&quot;)
  while(new_title[length(new_title)] != &quot;EOL&quot;) {
    new_title &lt;- c(new_title, 
                   word_transitions %&gt;% 
                     filter(word == new_title[length(new_title)]) %&gt;% 
                     sample_n(size = 1, weight = weight) %&gt;% 
                     pull(nxt))
  }
  new_title[-length(new_title)] %&gt;% paste(collapse = &quot; &quot;) %&gt;% stringr::str_to_title()
}
generate_title()
## [1] &quot;The One With The Cop&quot;</code></pre>
<p>Yeaaa! Here‚Äôs a few more:</p>
<pre class="r"><code>replicate(5, generate_title())
## [1] &quot;The One Where Rachel&quot;                  
## [2] &quot;The One With The Stain&quot;                
## [3] &quot;The One Without The Superbowl Part 1&quot;  
## [4] &quot;The One With Ross&#39;s Inappropriate Song&quot;
## [5] &quot;The One With The Race Car Bed&quot;</code></pre>
<p>Problem: since this is based on only 236 titles, it tends to generate titles that already exist. E.g., there is only one time the word ‚ÄòGeorge‚Äô shows up in a title, so anytime the title generator hits ‚ÄòThe One With George‚Äô, the next word will always be ‚ÄòStephanopolous‚Äô, and then it will always end.</p>
<p>We can try to fix this in the next installment, by using the <code>tidytext::parts_of_speech</code> dataset to generate sentence structures and then populate them with words, e.g., <code>&quot;the one where [noun] [verb]&quot;</code>.</p>
<p>Anyway, here‚Äôs a title that‚Äôs randomly generated every time Netlify rebuilds this post:</p>
</div>
<div id="the-one-where-theyre-going-away" class="section level1">
<h1>The One Where They‚Äôre Going Away</h1>
</div>
