---
title: 'Random sampling: replicate v. rep'
author: "Jesse Tweedle"
date: '2017-12-24'
slug: sampling-replicate-v-rep
categories: ["r", "random"]
tags: ["r"]
description: 'A short post to describe repeatedly randomly generating objects.'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(collapse = TRUE)
library(magrittr)
```

The problem: you want to generate a random collection of letters.

``` {r}
letters %>% sample(size = 4) %>% paste0(collapse = "") 
```

Great. Now do it 10 times.

``` {r}
letters %>% sample(size = 4) %>% paste0(collapse = "") %>% rep(8)
```

`r emo::ji('confounded')`. Why am I like this. Ok, `rep` copies the object 8 times. It doesn't draw 8 samples. So just write a function:

``` {r}
sample_letters <- function(size = 4) {
  letters %>% sample(size = size) %>% paste0(collapse = "")
}
rep_ <- purrr::safely(rep)
rep_(sample_letters, 8) %>% .$error %>% .$message
```

This gd thing (although I learned a bit about `safely` here, `r emo::ji('+1')`). It wants to repeat the function definition, not repeatedly run the function. Ok. 

``` {r}
rep(sample_letters(), 8)
```

Gd-it. Same problem. It runs the function once, then repeats the object 8 times. Ok, surely if I use `lapply` (or `sapply` = simplify apply?), which is designed to run functions a million times, this will work
``` {r}
sapply(1:8, function(x) { sample_letters() }) 
```

Ugh, finally. But a pyrrhic victory. The code is ugly and horrible and requires a function argument that we throw away like plastic bottles in the ocean and those arguments will come back and kill us all.

Ok, double-checking the documentation in `lapply`, there's finally one to do what I want. But of course (to Hadley's dismay, I'm sure), the syntax is halfway between `lapply` and `rep`, which makes it impossible to remember.

``` {r}
replicate(8, sample_letters())
```

The `n` argument comes first like an `apply`, while in `rep` it comes second, but it's called `replicate` and not `rapply`. On top of that, you can hack the regular `lapply` call to draw it randomly (as long as the size argument is in `sample_letters`), but now we've dropped the parentheses!

``` {r}
sapply(rep(4, 8), sample_letters)
```

If we do that with `replicate`, it replicates the function definition. `r emo::ji('rage')`. These are the mental steps I go through everytime I want to randomly sample something (usually just for fake data and testing).

## Answer, for now

``` {r}
replicate(8, sample_letters())
```

To do: understand wtf it's ok to repeat a function definition (like in `replicate` without parentheses) but not other times (like in `rep` without parentheses).
