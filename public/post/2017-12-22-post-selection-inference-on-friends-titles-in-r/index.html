<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta name="generator" content="Hugo 0.31.1" />
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post-selection inference on Friends titles in R | Jesse Tweedle</title>
    <meta name="description" content="This post applies post-selection procedure to estimating the effect of character names in Friends episode titles on their ratings. Ross is good, apparently.">
    <meta name="keywords" content="r, friends, tidytext, glmnet, lasso, post-selection inference, econometrics">
    
    
    
    
    

  <meta name="author" content="Jesse Tweedle">


    <meta property="og:title" content="Post-selection inference on Friends titles in R" />
<meta property="og:description" content="This post applies post-selection procedure to estimating the effect of character names in Friends episode titles on their ratings. Ross is good, apparently." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/post/2017-12-22-post-selection-inference-on-friends-titles-in-r/" />



<meta property="article:published_time" content="2017-12-22T15:33:11-05:00"/>

<meta property="article:modified_time" content="2017-12-22T15:33:11-05:00"/>











    




    <meta name="theme-color" content="#000">

    
    
    
    <link rel="canonical" href="/post/2017-12-22-post-selection-inference-on-friends-titles-in-r/">
    
    
    <link rel="icon" sizes="any" href="https://raw.githubusercontent.com/twitter/twemoji/gh-pages/svg/1f40c.svg">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<style>
  html{font-size:12px}*{box-sizing:border-box;text-rendering:geometricPrecision}body{font-size:1rem;line-height:1.5rem;margin:0;
/*font-family:Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif;*/
font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"
word-wrap:break-word}h1,h2,h3,h4,h5,h6{line-height:1.3em}fieldset{border:none;padding:0;margin:0}pre{padding:2rem;margin:1.75rem 0;background-color:#fff;border:1px solid #ccc;overflow:auto}code[class*=language-],pre[class*=language-],pre code{font-weight:100;text-shadow:none;margin:1.75rem 0}a{cursor:pointer;color:#06f;text-decoration:none;border-bottom:1px solid #06f}a:hover{background-color:#06f;color:#fff}.grid{display:-ms-flexbox;display:flex;-ms-flex-wrap:wrap;flex-wrap:wrap}.grid.\-top{-ms-flex-align:start;-ms-grid-row-align:flex-start;align-items:flex-start}.grid.\-middle{-ms-flex-align:center;-ms-grid-row-align:center;align-items:center}.grid.\-bottom{-ms-flex-align:end;-ms-grid-row-align:flex-end;align-items:flex-end}.grid.\-stretch{-ms-flex-align:stretch;-ms-grid-row-align:stretch;align-items:stretch}.grid.\-baseline{-ms-flex-align:baseline;-ms-grid-row-align:baseline;align-items:baseline}.grid.\-left{-ms-flex-pack:start;justify-content:flex-start}.grid.\-center{-ms-flex-pack:center;justify-content:center}.grid.\-right{-ms-flex-pack:end;justify-content:flex-end}.grid.\-between{-ms-flex-pack:justify;justify-content:space-between}.grid.\-around{-ms-flex-pack:distribute;justify-content:space-around}.cell{-ms-flex:1;flex:1;box-sizing:border-box}@media screen and (min-width:768px){.cell.\-1of12{-ms-flex:0 0 8.33333%;flex:0 0 8.33333%}.cell.\-2of12{-ms-flex:0 0 16.66667%;flex:0 0 16.66667%}.cell.\-3of12{-ms-flex:0 0 25%;flex:0 0 25%}.cell.\-4of12{-ms-flex:0 0 33.33333%;flex:0 0 33.33333%}.cell.\-5of12{-ms-flex:0 0 41.66667%;flex:0 0 41.66667%}.cell.\-6of12{-ms-flex:0 0 50%;flex:0 0 50%}.cell.\-7of12{-ms-flex:0 0 58.33333%;flex:0 0 58.33333%}.cell.\-8of12{-ms-flex:0 0 66.66667%;flex:0 0 66.66667%}.cell.\-9of12{-ms-flex:0 0 75%;flex:0 0 75%}.cell.\-10of12{-ms-flex:0 0 83.33333%;flex:0 0 83.33333%}.cell.\-11of12{-ms-flex:0 0 91.66667%;flex:0 0 91.66667%}}@media screen and (max-width:768px){.grid{-ms-flex-direction:column;flex-direction:column}.cell{-ms-flex:0 0 auto;flex:0 0 auto}}.hack,.hack blockquote,.hack code,.hack h1,.hack h2,.hack h3,.hack h4,.hack h5,.hack h6,.hack strong{font-size:1rem;font-style:normal; 
/*font-family:Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif*/
font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"  
}
.hack em{font-size:1rem;font-style:italic;font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"}
.hack blockquote,.hack code,.hack em,.hack strong{line-height:20px}.hack blockquote,.hack code,.hack footer,.hack h1,.hack h2,.hack h3,.hack h4,.hack h5,.hack h6,.hack header,.hack li,.hack ol,.hack p,.hack section,.hack ul{float:none;margin:0;padding:0}.hack blockquote,.hack h1,.hack ol,.hack p,.hack ul{margin-top:20px;margin-bottom:20px}.hack h1{position:relative;display:inline-block;display:table-cell;padding:20px 0 30px;margin:0;overflow:hidden}.hack h1:after{content:"====================================================================================================";position:absolute;bottom:10px;left:0}.hack h1+*{margin-top:0}.hack h2,.hack h3,.hack h4,.hack h5,.hack h6{position:relative;margin-bottom:1.75rem}.hack h2:before,.hack h3:before,.hack h4:before,.hack h5:before,.hack h6:before{display:inline}.hack h2:before{content:"## "}.hack h3:before{content:"### "}.hack h4:before{content:"#### "}.hack h5:before{content:"##### "}.hack h6:before{content:"###### "}.hack li{position:relative;display:block;padding-left:20px}.hack li:after{position:absolute;top:0;left:0}.hack ul>li:after{content:"-"}.hack ol{counter-reset:a}.hack ol>li:after{content:counter(a) ".";counter-increment:a}.hack blockquote{position:relative;padding-left:17px;padding-left:2ch;overflow:hidden}.hack blockquote:after{content:">\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>\A>";white-space:pre;position:absolute;top:0;left:0;line-height:20px}.hack em:after,.hack em:before{content:"";display:inline}
.hack li{margin-left:20px;}

/* inline code doesn't have pre. use that. to put in grey background. */
.hack code{font-size:1rem; background: #f4f4f4; font-family:Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif;}

.hack pre code:after,.hack pre code:before{content:''}.hack pre code{font-size:1rem; background: #fefffe; font-weight:400}.hack code:after,.hack code:before{display:inline}

.hack hr{position:relative;height:20px;overflow:hidden;border:0;margin:20px 0}.hack hr:after{content:"----------------------------------------------------------------------------------------------------";position:absolute;top:0;left:0;line-height:20px;width:100%;word-wrap:break-word}@-moz-document url-prefix(){.hack h1{display:block}}.hack-ones ol>li:after{content:"1."}p{margin:0 0 1.75rem}.container{max-width:70rem}.container,.container-fluid{margin:0 auto;padding:0 1rem}.inner{padding:1rem}.inner2x{padding:2rem}.pull-left{float:left}.pull-right{float:right}.progress-bar{height:8px;opacity:.8;background-color:#ccc;margin-top:12px}.progress-bar.progress-bar-show-percent{margin-top:38px}.progress-bar-filled{background-color:gray;height:100%;transition:width .3s ease;position:relative;width:0}.progress-bar-filled:before{content:'';border:6px solid transparent;border-top-color:gray;position:absolute;top:-12px;right:-6px}.progress-bar-filled:after{color:gray;content:attr(data-filled);display:block;font-size:12px;white-space:nowrap;position:absolute;border:6px solid transparent;top:-38px;right:0;-ms-transform:translateX(50%);transform:translateX(50%)}table{width:100%;border-collapse:collapse;margin:1.75rem 0;color:#778087}table td,table th{vertical-align:top;border:1px solid #ccc;line-height:15px;padding:10px}table thead th{font-size:10px}table tbody td:first-child{font-weight:700;color:#333}.form{width:30rem}.form-group{margin-bottom:1.75rem;overflow:auto}.form-group label{border-bottom:2px solid #ccc;color:#333;width:10rem;display:inline-block;height:38px;line-height:38px;padding:0;float:left;position:relative}.form-group.form-success label{color:#4caf50!important;border-color:#4caf50!important}.form-group.form-warning label{color:#06f!important;border-color:#06f!important}.form-group.form-error label{color:#f44336!important;border-color:#f44336!important}.form-control{outline:none;border:none;border-bottom:2px solid #ccc;padding:.5rem 0;width:20rem;height:38px;background-color:transparent}.form-control:focus{border-color:#555}.form-group.form-textarea label:after{position:absolute;content:'';width:2px;background-color:#fff;right:-2px;top:0;bottom:0}textarea.form-control{height:auto;resize:none;padding:1rem 0;border-bottom:2px solid #ccc;border-left:2px solid #ccc;padding:.5rem}select.form-control{border-radius:0;background-color:transparent;-webkit-appearance:none;-moz-appearance:none;-ms-appearance:none}.help-block{color:#999;margin-top:.5rem}.form-actions{margin-bottom:1.75rem}.btn{display:-ms-inline-flexbox;display:inline-flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;cursor:pointer;outline:none;padding:.65rem 2rem;font-size:1rem;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:relative;z-index:1}.btn:active{box-shadow:inset 0 1px 3px rgba(0,0,0,.12)}.btn.btn-ghost{border-color:#757575;color:#757575;background-color:transparent}.btn.btn-ghost:focus,.btn.btn-ghost:hover{border-color:#424242;color:#424242;z-index:2}.btn.btn-ghost:hover{background-color:transparent}.btn-block{width:100%;display:-ms-flexbox;display:flex}.btn-default{color:#fff;background-color:#e0e0e0;border:1px solid #e0e0e0;color:#333}.btn-default:focus:not(.btn-ghost),.btn-default:hover{background-color:#dcdcdc;border-color:#dcdcdc}.btn-success{color:#fff;background-color:#4caf50;border:1px solid #4caf50}.btn-success:focus:not(.btn-ghost),.btn-success:hover{background-color:#43a047;border-color:#43a047}.btn-success.btn-ghost{border-color:#4caf50;color:#4caf50}.btn-success.btn-ghost:focus,.btn-success.btn-ghost:hover{border-color:#388e3c;color:#388e3c;z-index:2}.btn-error{color:#fff;background-color:#f44336;border:1px solid #f44336}.btn-error:focus:not(.btn-ghost),.btn-error:hover{background-color:#e53935;border-color:#e53935}.btn-error.btn-ghost{border-color:#f44336;color:#f44336}.btn-error.btn-ghost:focus,.btn-error.btn-ghost:hover{border-color:#d32f2f;color:#d32f2f;z-index:2}.btn-warning{color:#fff;background-color:#06f;border:1px solid #06f}.btn-warning:focus:not(.btn-ghost),.btn-warning:hover{background-color:#fb8c00;border-color:#fb8c00}.btn-warning.btn-ghost{border-color:#06f;color:#06f}.btn-warning.btn-ghost:focus,.btn-warning.btn-ghost:hover{border-color:#f57c00;color:#f57c00;z-index:2}.btn-info{color:#fff;background-color:#00bcd4;border:1px solid #00bcd4}.btn-info:focus:not(.btn-ghost),.btn-info:hover{background-color:#00acc1;border-color:#00acc1}.btn-info.btn-ghost{border-color:#00bcd4;color:#00bcd4}.btn-info.btn-ghost:focus,.btn-info.btn-ghost:hover{border-color:#0097a7;color:#0097a7;z-index:2}.btn-primary{color:#fff;background-color:#2196f3;border:1px solid #2196f3}.btn-primary:focus:not(.btn-ghost),.btn-primary:hover{background-color:#1e88e5;border-color:#1e88e5}.btn-primary.btn-ghost{border-color:#2196f3;color:#2196f3}.btn-primary.btn-ghost:focus,.btn-primary.btn-ghost:hover{border-color:#1976d2;color:#1976d2;z-index:2}.btn-group{overflow:auto}.btn-group .btn{float:left}.btn-group .btn-ghost:not(:first-child){margin-left:-1px}.card{border:1px solid #ccc}.card .card-header{color:#333;text-align:center;background-color:#ddd;padding:.5rem 0}.alert{color:#ccc;padding:1rem;border:1px solid #ccc;margin-bottom:1.75rem}.alert-success{color:#4caf50;border-color:#4caf50}.alert-error{color:#f44336;border-color:#f44336}.alert-info{color:#00bcd4;border-color:#00bcd4}.alert-warning{color:#06f;border-color:#06f}.media:not(:last-child){margin-bottom:1.25rem}.media-left{padding-right:1rem}.media-left,.media-right{display:table-cell;vertical-align:top}.media-right{padding-left:1rem}.media-body{display:table-cell;vertical-align:top}.media-heading{font-size:1.16667rem;font-weight:700}.media-content{margin-top:.3rem}.avatarholder,.placeholder{background-color:#f0f0f0;text-align:center;color:#b9b9b9;font-size:1rem;border:1px solid #f0f0f0}.avatarholder{width:48px;height:48px;line-height:46px;font-size:2rem;background-size:cover;background-position:50%;background-repeat:no-repeat}.avatarholder.rounded{border-radius:33px}.loading{display:inline-block;content:'&nbsp;';height:20px;width:20px;margin:0 .5rem;animation:a .6s infinite linear;border:2px solid #e91e63;border-right-color:transparent;border-radius:50%}.btn .loading{margin-bottom:0;width:14px;height:14px}.btn div.loading{float:left}.alert .loading{margin-bottom:-5px}@keyframes a{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}.menu{width:100%}.menu .menu-item{display:block;color:#616161;border-color:#616161}.menu .menu-item.active,.menu .menu-item:hover{color:#000;border-color:#000;background-color:transparent}@media screen and (max-width:768px){.form-group label{display:block;border-bottom:none;width:100%}.form-group.form-textarea label:after{display:none}.form-control{width:100%}textarea.form-control{border-left:none;padding:.5rem 0}pre::-webkit-scrollbar{height:3px}}@media screen and (max-width:480px){.form{width:100%}}
  :root {
  --screen-size-small: 30em; /* breakpoint reference only */
}
@keyframes intro {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
.muted {
  color: rgba(0, 0, 0, 0.7);
}
.responsive-iframe {
  position: relative;
  padding-bottom: 56.25%; /* 16:9 */
  padding-top: 25px;
  height: 0;
}
.responsive-iframe iframe {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
}
iframe {
  border: 0;
}
main, footer {
  animation: intro 0.3s both;
  animation-delay: 0.15s;
}
footer time[datetime$="M"]:before {
  content: "\2013\0020";
}
@media only screen
  and ( max-width: 30em ) {
  footer time[datetime$="M"] {
    display: none;
  }
}
blockquote cite {
  display: block;
}
blockquote cite::before {
   content: "\2014";
}
:target {
  color: #fff;
}
/* hack.css overrides and enhancements */
.hack li ul {
  margin: 0;
}
.main {
  padding: 20px 10px;
}
nav a.active {
  background-color: #06f;
  color: #fff;
}
a[itemprop="url"] {
  color: #06f;
}
a[itemprop="url"]:hover {
  color: #fff;
}
a[href*="://"]::after,
a[rel*="external"] {
  content: " " url("data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20class='i-external'%20viewBox='0%200%2032%2032'%20width='14'%20height='14'%20fill='none'%20stroke='%23ff9800'%20stroke-linecap='round'%20stroke-linejoin='round'%20stroke-width='9.38%'%3E%3Cpath%20d='M14%209%20L3%209%203%2029%2023%2029%2023%2018%20M18%204%20L28%204%2028%2014%20M28%204%20L14%2018'/%3E%3C/svg%3E");
}
figure a[href*="://"]::after,
figure a[rel*="external"] {
  content: "";
}
html {
  font-size: 13px;
}
.hack pre {
  font-size: 17px;
}
article {
  margin-bottom: 20px;
}
article [itemprop="description"] {
  margin-bottom: 20px;
  margin-top: 20px;
}
@media screen and (min-width: 768px) {
  html {
    font-size: 1em;
  }
  .container {
    max-width: 50rem;
  }
}

  /*
Atom One Light by Daniel Gamage Nope.
Original One Light Syntax theme from https://github.com/atom/one-light-syntax
base:    #fafafa
mono-1:  #383a42
mono-2:  #686b77
mono-3:  #a0a1a7
hue-1:   #0184bb
hue-2:   #4078f2
hue-3:   #a626a4
hue-4:   #50a14f
hue-5:   #e45649
hue-5-2: #c91243
hue-6:   #986801
hue-6-2: #c18401
*/

/*
.r {
  background: #fafafa;
}

.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  color: #383a42;
  background: #fafafa;
  font-size: ;
}

.hljs-comment,
.hljs-quote {
  color: #a0a1a7;
  font-style: italic;
}

.hljs-doctag,
.hljs-keyword,
.hljs-formula {
  color: #a626a4;
}

.hljs-section,
.hljs-name,
.hljs-selector-tag,
.hljs-deletion,
.hljs-subst {
  color: #e45649;
}

.hljs-literal {
  color: #0184bb;
}

.hljs-string,
.hljs-regexp,
.hljs-addition,
.hljs-attribute,
.hljs-meta-string {
  color: #bf3f3f;
}

.hljs-built_in,
.hljs-class .hljs-title {
  color: #c18401;
}

.hljs-attr,
.hljs-variable,
.hljs-template-variable,
.hljs-type,
.hljs-selector-class,
.hljs-selector-attr,
.hljs-selector-pseudo,
.hljs-number {
  color: #56338c;
}

.hljs-symbol,
.hljs-bullet,
.hljs-link,
.hljs-meta,
.hljs-selector-id,
.hljs-title {
  color: #4078f2;
}

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: bold;
}

.hljs-link {
  text-decoration: underline;
}*/

.r {
  background: #fefffe;
}

/*

XCode style (c) Angel Garcia <angelgarcia.mail@gmail.com>

*/

.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  background: #fefffe;
  color: black;
}

.hljs-comment,
.hljs-quote {
  color: #757990;
}

.hljs-keyword,
.hljs-selector-tag,
.hljs-literal {
  color: #aa0d91;
}

.hljs-name {
  color: #008;
}

.hljs-variable,
.hljs-template-variable {
  color: #660;
}

.hljs-string {
  color: #c41a16;
}

.hljs-regexp,
.hljs-link {
  color: #080;
}

.hljs-title,
.hljs-tag,
.hljs-symbol,
.hljs-bullet,
.hljs-number,
.hljs-meta {
  color: #1c00cf;
}

.hljs-section,
.hljs-class .hljs-title,
.hljs-type,
.hljs-attr,
.hljs-built_in,
.hljs-builtin-name,
.hljs-params {
  color: #5c2699;
}

.hljs-attribute,
.hljs-subst {
  color: #000;
}

.hljs-formula {
  background-color: #eee;
  font-style: italic;
}

.hljs-addition {
  background-color: #baeeba;
}

.hljs-deletion {
  background-color: #ffc8bd;
}

.hljs-selector-id,
.hljs-selector-class {
  color: #9b703f;
}

.hljs-doctag,
.hljs-strong {
  font-weight: bold;
}

.hljs-emphasis {
  font-style: italic;
}

.hack h1 {
  font-size: 1.2rem; font-family: Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif;
}

.hack h2 {
  font-size: 1.1rem; font-family: Consolas,Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace,serif;
}

</style>

    
    
    
      <script async src="/js/bpgdec8a.js"></script>
      <script async src="/js/bpgdec8.js"></script>
      <script async src="/js/bpgdec.js"></script>
    
  </head>
  
  <body class="hack dark main container">
    <header>
  
  <nav itemscope itemtype="http://schema.org/SiteNavigationElement">
    
    
      <a itemprop="url" class="" href="/"><span itemprop="name">Home</span></a>
    
      <a itemprop="url" class="" href="/post/"><span itemprop="name">Posts</span></a>
    
      <a itemprop="url" class="" href="/cv/"><span itemprop="name">CV</span></a>
    
      <a itemprop="url" class="" href="https://github.com/tweed1e"><span itemprop="name">Github</span></a>
    
      <a itemprop="url" class="" href="https://twitter.com/tweed1e"><span itemprop="name">Twitter</span></a>
    
  </nav>


</header>
    <main>
  <article itemscope itemtype="http://schema.org/BlogPosting">
    
<meta itemprop="name" content="Post-selection inference on Friends titles in R">
<meta itemprop="description" content="This post applies post-selection procedure to estimating the effect of character names in Friends episode titles on their ratings. Ross is good, apparently.">


<meta itemprop="datePublished" content="2017-12-22T15:33:11-05:00" />
<meta itemprop="dateModified" content="2017-12-22T15:33:11-05:00" />
<meta itemprop="wordCount" content="2021">



<meta itemprop="keywords" content="r,friends,tidytext,glmnet,lasso,post-selection inference,econometrics," />

    <header>
      <h1 itemprop="headline">Post-selection inference on Friends titles in R</h1>
      <p class="muted">
        <svg style="margin-bottom:-3px" class="i-clock" viewBox="0 0 32 32" width="16" height="16" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%">
  <circle cx="16" cy="16" r="14" />
  <path d="M16 8 L16 16 20 20" />
</svg>
<span>10 minute read</span>
<svg style="margin-bottom: -3px" class="i-edit" viewBox="0 0 32 32" width="16" height="16" fill="none" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="6.25%">
  <path d="M30 7 L25 2 5 22 3 29 10 27 Z M21 6 L26 11 Z M5 22 L10 27 Z" />
</svg>

  Published: <time datetime="2017-12-22T15:33:11-05:00">22 Dec, 2017</time>


      </p>
    </header>
    
      <blockquote itemprop="description">This post applies post-selection procedure to estimating the effect of character names in Friends episode titles on their ratings. Ross is good, apparently.</blockquote>
    
    

    <div itemprop="articleBody">
      <div id="goal" class="section level2">
<h2>Goal</h2>
<p>I want to be a Friends scriptwriter. Can I pick a title that makes an episode an automatic classic? If I just include a character’s name in the title, does it make it automatically popular? I assume I should just write “The One Where Rachel is Rachel”. But let’s investigate.</p>
<p>The question: what is the effect of a character’s name in the episode title on the episode rating?</p>
</div>
<div id="data" class="section level2">
<h2>Data</h2>
<p>We’ll use Friends data we <code>rvest</code>ed from IMDB in a <a href="/post/2017-12-18-rvest-friends-episodes/">previous post</a>, or just load it via <code>devtools::install_github('tweed1e/werfriends')</code>.</p>
<pre class="r"><code>titles &lt;- werfriends::friends_episodes %&gt;% as_tibble()
titles
## # A tibble: 236 x 7
##    season episode                                           title rating
##     &lt;dbl&gt;   &lt;dbl&gt;                                           &lt;chr&gt;  &lt;dbl&gt;
##  1      1       1           The One Where Monica Gets a Roommate     8.5
##  2      1       2           The One with the Sonogram at the End     8.2
##  3      1       3                         The One with the Thumb     8.3
##  4      1       4             The One with George Stephanopoulos     8.3
##  5      1       5 The One with the East German Laundry Detergent     8.6
##  6      1       6                          The One with the Butt     8.3
##  7      1       7                      The One with the Blackout     9.0
##  8      1       8                  The One Where Nana Dies Twice     8.2
##  9      1       9               The One Where Underdog Gets Away     8.3
## 10      1      10                        The One with the Monkey     8.2
## # ... with 226 more rows, and 3 more variables: n_ratings &lt;dbl&gt;,
## #   director &lt;list&gt;, writers &lt;list&gt;</code></pre>
<p>The problem: all we really have is titles, writers and directors. How do we use natural language information to predict episode ratings? My first idea is to use dummy variables (aka factors with levels <code>c(&quot;0&quot;,&quot;1&quot;)</code>) to encode the title words and director and writer names. In other words, the S4E19 episode titled “The One with All the Haste” would have a <code>1</code> in variable <code>haste</code>, but a <code>0</code> for every character dummy variable <code>ross</code>, <code>rachel</code>, etc. (S4E19 is the ep where Monica and Rachel steal their apartment back from Chandler and Joey. So good.)</p>
</div>
<div id="method" class="section level2">
<h2>Method</h2>
<p>So, once we create language dummy variables to try to control for episode characteristics that may affect ratings, we find ourselves with too many predictors. There are only 236 episodes but we create way more language dummies 🤔.</p>
<p>This is a high-dimensional problem, with more explanatory variables than observations, <code>p&gt;&gt;n</code>. A few econometricians have proposed a post-selection estimator to solve these problems, which have a slightly different flavour than normal machine learning / prediction problems.</p>
<p>Consider the goal: I want to know the effect of including a character’s name in an episode title. LASSO selects important variables that predict the outcome (rating, in my case). If we don’t penalize the character names, and there is another variable that is correlated with the outcome and one of the character names, then we end up with a biased estimate of the character effect. E.g., say most “Ross” episodes are directed by Kevin Bright, who is a “good” director according to the mean rating of all the episodes he directed). Then LASSO selects “Ross” to be in the model, but drops “Kevin Bright” because it’s so correlated with “Ross” (which means it doesn’t improve the rating prediction much), and LASSO will tell us that “Ross” has a high positive coefficient. But we know that Ross is trash and it’s only because Kevin Bright directed his episodes!</p>
<p>The solution is called <strong>post-selection inference</strong>, explained in <a href="http://www.jstor.org/stable/23723483?casa_token=UtP_wvb6MYcAAAAA:jiY5Fzx0lZppTE4J3hiXcZu4_-_zxqjz1n9cc5dsQELc8NnEE8msIi3ZirYaGAXJLR1Dns_QV0pWbAqvneNm-U4OPuNNDWAzBqFjglKnX4Mg_RwyKys6kA&amp;seq=9#page_scan_tab_contents">“High-dimensional methods and inference on structural and treatment effects”</a> (Belloni, et al. 2013). They actually call it a ‘double selection procedure’ or post-double-selection, but post-selection is fine with me.</p>
<p>The idea is: run LASSO on the outcome variable and everything but the character names; then run LASSO on each of the character names and the rest of the RHS variables. Take all the non-zero coefficients from all of these LASSO results, then regress rating on all the selected variables via a linear model (aka ordinary least squares).</p>
</div>
<div id="code" class="section level2">
<h2>Code</h2>
<p>There are a few annoying steps.</p>
<p>First, I use <code>tidytext</code> to convert titles to words, and then <code>spread</code> those words into dummy factors for the dataset (the dataset is very ‘wide’ after this). I create dummy factors for directors and writers as well.</p>
<p>Next, run the naive linear model, and save the estimates. Then run naive LASSO and save the estimates. Then run the double-selection procedure.</p>
<div id="process" class="section level3">
<h3>Process</h3>
<p>Do ugly stuff (<a href="https://github.com/tweed1e/weblog/tree/master/content/post/2017-12-22-post-selection-inference-on-friends-titles-in-r">check source</a>) for full code and end up with this:</p>
<pre class="r"><code># the dataset
episodes
## # A tibble: 236 x 352
##    rating chandler   joey monica phoebe rachel   ross season episode
##     &lt;dbl&gt;   &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt; &lt;fctr&gt;  &lt;fctr&gt;
##  1    8.5        0      0      1      0      0      0      1       1
##  2    8.2        0      0      0      0      0      0      1       2
##  3    8.3        0      0      0      0      0      0      1       3
##  4    8.3        0      0      0      0      0      0      1       4
##  5    8.6        0      0      0      0      0      0      1       5
##  6    8.3        0      0      0      0      0      0      1       6
##  7    9.0        0      0      0      0      0      0      1       7
##  8    8.2        0      0      0      0      0      0      1       8
##  9    8.3        0      0      0      0      0      0      1       9
## 10    8.2        0      0      0      0      0      0      1      10
## # ... with 226 more rows, and 343 more variables: n_ratings &lt;fctr&gt;,
## #   after &lt;fctr&gt;, apothecary &lt;fctr&gt;, armadillo &lt;fctr&gt;, assistant &lt;fctr&gt;,
## #   award &lt;fctr&gt;, baby &lt;fctr&gt;, babysits &lt;fctr&gt;, bag &lt;fctr&gt;, ball &lt;fctr&gt;,
## #   ballroom &lt;fctr&gt;, barbados &lt;fctr&gt;, barry &lt;fctr&gt;, bath &lt;fctr&gt;,
## #   beach &lt;fctr&gt;, bed &lt;fctr&gt;, bing &lt;fctr&gt;, birth &lt;fctr&gt;, birthday &lt;fctr&gt;,
## #   birthing &lt;fctr&gt;, blackout &lt;fctr&gt;, blind &lt;fctr&gt;, boob &lt;fctr&gt;,
## #   boobies &lt;fctr&gt;, book &lt;fctr&gt;, boots &lt;fctr&gt;, box &lt;fctr&gt;, brain &lt;fctr&gt;,
## #   breast &lt;fctr&gt;, bullies &lt;fctr&gt;, bus &lt;fctr&gt;, butt &lt;fctr&gt;,
## #   c.h.e.e.s.e &lt;fctr&gt;, cake &lt;fctr&gt;, candy &lt;fctr&gt;, car &lt;fctr&gt;, cat &lt;fctr&gt;,
## #   caught &lt;fctr&gt;, champion &lt;fctr&gt;, cheap &lt;fctr&gt;, cheesecakes &lt;fctr&gt;,
## #   chick &lt;fctr&gt;, chicken &lt;fctr&gt;, christmas &lt;fctr&gt;, class &lt;fctr&gt;,
## #   closet &lt;fctr&gt;, consuela &lt;fctr&gt;, cookies &lt;fctr&gt;, cooking &lt;fctr&gt;,
## #   cop &lt;fctr&gt;, cousin &lt;fctr&gt;, cries &lt;fctr&gt;, crosses &lt;fctr&gt;, crush &lt;fctr&gt;,
## #   cry &lt;fctr&gt;, cuffs &lt;fctr&gt;, dad &lt;fctr&gt;, dancing &lt;fctr&gt;, date &lt;fctr&gt;,
## #   dates &lt;fctr&gt;, day &lt;fctr&gt;, denial &lt;fctr&gt;, detergent &lt;fctr&gt;,
## #   device &lt;fctr&gt;, dies &lt;fctr&gt;, dinner &lt;fctr&gt;, dirty &lt;fctr&gt;, dogs &lt;fctr&gt;,
## #   dollhouse &lt;fctr&gt;, donor &lt;fctr&gt;, dozen &lt;fctr&gt;, dr &lt;fctr&gt;, dream &lt;fctr&gt;,
## #   dress &lt;fctr&gt;, dresses &lt;fctr&gt;, duck &lt;fctr&gt;, east &lt;fctr&gt;, eddie &lt;fctr&gt;,
## #   eggplant &lt;fctr&gt;, elizabeth &lt;fctr&gt;, embryos &lt;fctr&gt;, emma &lt;fctr&gt;,
## #   engagement &lt;fctr&gt;, estelle &lt;fctr&gt;, everybody &lt;fctr&gt;, evil &lt;fctr&gt;,
## #   factor &lt;fctr&gt;, fake &lt;fctr&gt;, fantasy &lt;fctr&gt;, fertility &lt;fctr&gt;,
## #   fighting &lt;fctr&gt;, fine &lt;fctr&gt;, flashback &lt;fctr&gt;, flirt &lt;fctr&gt;,
## #   football &lt;fctr&gt;, forward &lt;fctr&gt;, frank &lt;fctr&gt;, free &lt;fctr&gt;,
## #   french &lt;fctr&gt;, fridge &lt;fctr&gt;, ...
# also created `ep_mm`, a sparse model matrix based on `episodes`</code></pre>
<p>This is a dataset with a million factors for different words that show up in titles, and factors for all the directors and writers. There are only 236 episodes/observations but 351 potential explanatory variables, leaving us in a high-dimensional situation <code>p&gt;&gt;n</code> (although a pretty low dimensional high dimensional situation).</p>
</div>
<div id="do-naive-linear-model-ols" class="section level3">
<h3>Do naive linear model / OLS</h3>
<p>The naive linear model resolves the high dimensional problem by selecting variables manually: I want to control for season and episode effects, and estimate the character effects.</p>
<pre class="r"><code>naive &lt;- lm(rating ~ season + episode + 
              chandler + joey + monica + 
              phoebe + rachel + ross, 
            data = episodes)</code></pre>
</div>
<div id="do-naive-lasso" class="section level3">
<h3>Do naive LASSO</h3>
<p>Or we could use LASSO to select our control variables for us; we remove the penalty on the characters to ensure these coefficients are estimated to be non-zero.</p>
<pre class="r"><code># penalty factor: 0 for the first 6 variables (the characters), 
# then 1 for the rest.
penalty.factor &lt;- c(rep(0, 6), rep(1, ncol(ep_mm) - 6))

# use `glmnet` to run cross-validated lasso with new penalty.factor
c &lt;- cv.glmnet(ep_mm, episodes$rating, penalty.factor = penalty.factor) %&gt;%
  coef(s = &#39;lambda.min&#39;) %&gt;% .[-1,] # save the optimal coefficients 

# then create dataset of coefficient estimates
lasso &lt;- tibble(term = names(c), estimate = c)
lasso
## # A tibble: 236 x 2
##         term      estimate
##        &lt;chr&gt;         &lt;dbl&gt;
##  1 chandler1  0.1176019972
##  2     joey1 -0.0471344876
##  3   monica1 -0.0344661784
##  4   phoebe1 -0.1441493845
##  5   rachel1 -0.0431721298
##  6     ross1  0.1990786702
##  7   season2  0.0000000000
##  8   season3 -0.0001827438
##  9   season4  0.0006538244
## 10   season5  0.0597535505
## # ... with 226 more rows</code></pre>
</div>
<div id="do-post-selection-estimation" class="section level3">
<h3>Do post-selection estimation</h3>
<pre class="r"><code>
get_lasso_coefs &lt;- function(name, x) { 
# function that returns non-zero coefficients that
# that predict one of the RHS variables
  c &lt;- cv.glmnet(x[, colnames(x) != name], x[,name]) %&gt;%
    coef(s = &#39;lambda.min&#39;) %&gt;% .[-1,]
  names(c)[c != 0]
}

get_lasso_coefs_ &lt;- function(y, names, x) { 
# function that returns non-zero coefficients that
# that predict the RHS variables (first removing the characters)
  c &lt;- cv.glmnet(x[, !colnames(x) %in% names], y) %&gt;%
    coef(s = &#39;lambda.min&#39;) %&gt;% .[-1,]
  names(c)[c != 0] # only return names that are non-zero
}</code></pre>
<p>With those functions, now we loop over the relevant character variables and return non-zero LASSO coefficients.</p>
<pre class="r"><code># list of characters
friends &lt;- c(&quot;chandler&quot;, 
             &quot;joey&quot;, 
             &quot;monica&quot;, 
             &quot;phoebe&quot;, 
             &quot;rachel&quot;, 
             &quot;ross&quot;) %&gt;% 
  map_chr(paste0, &quot;1&quot;)

# map list of characters into lasso coefficient function
lasso_coefs &lt;- friends %&gt;%
  map(get_lasso_coefs, x = ep_mm) %&gt;% 
  unlist() 

# put all the selected variables together
post_vars &lt;- c(friends, 
          lasso_coefs,
          get_lasso_coefs_(episodes$rating, friends, ep_mm)) %&gt;% unique()

# process the variables: &#39;episode1&#39; should be &#39;episode1&#39;, 
# but &#39;chandler1&#39; should be &#39;chandler&#39;
post_vars &lt;- post_vars %&gt;% 
  as_tibble() %&gt;% 
  mutate(value = ifelse(grepl(&quot;season|episode&quot;, value), 
                        value, 
                        gsub(&quot;\\d$&quot;, &quot;&quot;, value))) %&gt;%
  pull(value) %&gt;% c(gsub(&quot;1&quot;, &quot;&quot;, friends), .) %&gt;% unique()

post_dat &lt;- episodes %&gt;% mutate(x = 1) %&gt;% 
  spread(key = season, value = x, fill = 0, sep = &quot;&quot;) %&gt;% mutate(x = 1) %&gt;% 
  spread(key = episode, value = x, fill = 0, sep = &quot;&quot;) %&gt;% 
  mutate_at(vars(-rating), factor) %&gt;% 
  select(one_of(c(&quot;rating&quot;, post_vars)))

# the post-selection lm formula
f &lt;- paste(&quot;rating ~ &quot;, paste(post_vars, collapse = &quot; + &quot;))</code></pre>
</div>
</div>
<div id="results" class="section level2">
<h2>Results</h2>
<pre class="r"><code>coefs &lt;- bind_rows(
  # post-selection model coefficients
  lm(f, data = post_dat) %&gt;% summary() %&gt;% tidy() %&gt;% 
    .[2:7,] %&gt;% as_tibble() %&gt;% mutate(model = &quot;post lm&quot;),
  # naive lm model coefficients
  naive %&gt;% tidy() %&gt;% tail() %&gt;% as_tibble() %&gt;% mutate(model = &quot;naive lm&quot;),
  # lasso selection
  lasso[1:6, ] %&gt;%  mutate(model = &quot;lasso&quot;)
)

# bar chart for coefficients + errorbars by character and model
coefs %&gt;% 
  ggplot(aes(x = factor(term), y = estimate, group = factor(model), fill = factor(model))) + 
  geom_col(position = &#39;dodge&#39;) + 
  geom_errorbar(
    aes(ymin = estimate - 1.96 * std.error, ymax = estimate + 1.96 * std.error),
    width = 0.4,
    position = position_dodge(width = 0.9)
  ) + labs(title = &#39;Post-selection model coefficients are the best&#39;, x = &#39;Character&#39;, y = &#39;Estimate&#39;)
## Warning: Removed 6 rows containing missing values (geom_errorbar).</code></pre>
<p><img src="/post/2017-12-22-post-selection-inference-on-friends-titles-in-r_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>The naive linear model (significantly) says Joey sucks! If Joey’s in an episode, the episode is typically 0.19 stars lower! Phoebe also sucks, but not with such certainty. The naive linear model is also pretty sure none of the other characters matter.</p>
<p>The naive LASSO model reverses that: Joey doesn’t matter as much; but Phoebe still sucks and Ross is now great! (NB: you know that’s not true, Ross is trash.)</p>
<p>Ok, I was wrong, the post-selection procedure thinks Ross is great. Most of the other characters’ estimates are closer to zero, and much different than the naive linear model. Phoebe looks especially vindicated by the post-selection model. (The error bars really drive home the uncertainty, thanks to the tips in the <a href="http://ggplot2.tidyverse.org/reference/position_dodge.html">ggplot2 docs</a> I found while trying to figure out <code>position = 'dodge'</code> in the <code>goem_col</code>s.) Of course we’re not dealing with a sample of Friends eps, so it’s hard to say what the standard errors are supposd to represent, really. But that’s a subject for another time.</p>
<p>What does that mean for us? I thought character names would matter (e.g., ‘Rachel’ episodes would be rated higher), they don’t, and post-selection inference seems robust. So when I write my Friends episodes, I don’t have to care too much about putting characters in the titles, other than Ross, and I’m defo not writing a Ross episode. Or maybe I’ll write “The One without Ross”.</p>
</div>

    </div>
    
    <footer>
      <hr>
      <p>
  Published
  
    
      by <span itemprop="author">Jesse Tweedle</span>
    
  
  <time itemprop="datePublished" datetime="2017-12-22T15:33:11-05:00">
    22 Dec, 2017
  </time>
  
    in <span itemprop="articleSection"><a href="/categories/r/">r</a></span>
  
  
    and tagged <a href="/tags/econometrics/">econometrics</a>, <a href="/tags/friends/">friends</a>, <a href="/tags/glmnet/">glmnet</a>, <a href="/tags/lasso/">lasso</a>, <a href="/tags/post-selection-inference/">post-selection inference</a>, <a href="/tags/r/">r</a> and <a href="/tags/tidytext/">tidytext</a>
  
  using <span itemprop="wordCount">2021</span> words.
</p>

      


  <aside>
    <header>Related Content</header>
    <ul>
      
        <li><a href="/post/2017-12-18-rvest-friends-episodes/">rvest &#43; imdb -&gt; explore Friends episode titles</a>
        <time datetime="11M">11 minutes</time>
      
        <li><a href="/post/rstats-closure-windows-parallel/">Functional programming #rstats: closure hack for parallel processing on windows!</a>
        <time datetime="4M">4 minutes</time>
      
    </ul>
  </aside>


    </footer>
  </article>
</main>
    <footer>
  
  <p class="muted">
    This page was generated using
    <a target="_blank" rel="noopener" href="https://comfusion.github.io/after-dark/">After Dark</a>
    for
    <a target="_blank" rel="noopener" href="https://gohugo.io/">Hugo</a>.
  </p>


</footer>
  </body>
</html>
